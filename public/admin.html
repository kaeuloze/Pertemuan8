<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            background: #f3e9d6; 
            font-family: 'Inter', sans-serif;
        }

        /* CARD UTAMA */
        .main-card {
            max-width: 950px;
            background: white;
            padding: 35px;
            border-radius: 14px;
            margin: 60px auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* HEADER */
        h1 {
            font-weight: 700;
            font-size: 34px;
            color: #0f544f;
        }

        .subtitle {
            color: #666;
            margin-bottom: 25px;
        }

        /* BUTTON LOGOUT */
        .btn-logout {
            background: #d9534f;
            border: none;
            padding: 10px 20px;
            color: white;
            border-radius: 8px;
            font-weight: 500;
        }
        .btn-logout:hover {
            background: #c74440;
        }

        /* TABLE STYLE */
        .table thead {
            background: #0f544f;
            color: white;
        }

        .api-box {
            background: #0d0d0d;
            color: #00ffbf;
            font-family: monospace;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 13px;
        }

        /* BADGE STATUS */
        .badge-online {
            background: #22c55e;
            color: black;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 13px;
        }

        .badge-offline {
            background: #e5e5e5;
            color: #444;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 13px;
            text-decoration: line-through;
        }

        footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
        }
    </style>
</head>

<body>

    <div class="main-card">

        <!-- HEADER -->
        <div class="d-flex justify-content-between">
            <div>
                <h1>Admin Dashboard</h1>
                <p class="subtitle">Manage user accounts & API keys</p>
            </div>

            <button id="logoutBtn" class="btn-logout">Logout</button>
        </div>

        <!-- STATUS -->
        <div id="statusMessage" class="alert alert-info text-center">
            Connecting to server...
        </div>

        <!-- TABLE -->
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Email</th>
                        <th>API Key</th>
                        <th>Status</th>
                        <th>Valid Until</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody"></tbody>
            </table>
        </div>

        <footer>&copy; 2025 System Core</footer>
    </div>

<script>
const API_USERS_URL = 'http://localhost:3000/admin/users';
const token = localStorage.getItem('adminToken');

const statusMessage = document.getElementById('statusMessage');
const usersTableBody = document.getElementById('usersTableBody');

// Redirect if not logged in
if (!token) {
    window.location.href = 'login.html';
} else {
    fetchUserData(token);
}

async function fetchUserData(jwt) {
    try {
        const res = await fetch(API_USERS_URL, {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${jwt}` }
        });

        if (res.status === 401 || res.status === 403) {
            localStorage.removeItem('adminToken');
            window.location.href = 'login.html';
        }

        const data = await res.json();

        if (res.ok) {
            statusMessage.style.display = 'none';
            renderTable(data);
        } else {
            statusMessage.textContent = "Error: " + (data.message || "Failed loading data");
            statusMessage.classList.remove("alert-info");
            statusMessage.classList.add("alert-danger");
        }

    } catch {
        statusMessage.textContent = "Server Offline";
        statusMessage.classList.remove("alert-info");
        statusMessage.classList.add("alert-danger");
    }
}

function renderTable(users) {
    usersTableBody.innerHTML = "";

    if (users.length === 0) {
        usersTableBody.innerHTML =
            `<tr><td colspan="6" class="text-center py-4">No data found.</td></tr>`;
        return;
    }

    users.forEach(u => {
        const rawDate = u.OUT_OF_DATE || u.out_of_date;
        const date = rawDate
            ? new Date(rawDate).toLocaleDateString("id-ID")
            : "-";

        const online = (u.STATUS || u.status) === "Active";

        usersTableBody.innerHTML += `
            <tr>
                <td class="fw-semibold">${u.id || u.ID}</td>
                <td>${(u.FIRST_NAME || u.first_name)} ${(u.LAST_NAME || u.last_name)}</td>
                <td>${u.EMAIL || u.email}</td>
                <td><span class="api-box">${u.KEY_VALUE || u.key_value}</span></td>
                <td><span class="${online ? "badge-online" : "badge-offline"}">${online ? "ONLINE" : "OFFLINE"}</span></td>
                <td>${date}</td>
            </tr>
        `;
    });
}

document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("adminToken");
    window.location.href = "index.html";
});
</script>

</body>
</html>
